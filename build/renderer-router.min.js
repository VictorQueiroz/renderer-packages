!function(){!function(e,t){"use strict";!function(e){function t(){this._events={}}function r(e){return"undefined"==typeof e}t.prototype={on:function(e,t){return this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t),this},off:function(e,t){var r,n=this._events[e];for(r=0;r<n.length;r++)n[r]==t&&n.splice(r,1);return this},emit:function(e){var t,o,i,s=n(arguments).slice(1);if(this._events.hasOwnProperty(e)){for(i=this._events[e],o=new Array(i.length),t=0;t<i.length;t++)o[t]=i[t].apply(this,s);return o.every(function(e){return r(e)?!0:e})}return!0},removeAllListeners:function(){var e,t,r=Object.keys(this._events),n=r.length;for(e=0;n>e;e++)t=r[e],this._events[t]=[]}};var n=function(e){return Array.prototype.slice.call(e)};Array.isArray,e.eventemitter={EventEmitter:t}}(e),!function(){function t(e){return null!=e&&"object"==typeof e}function r(e){return"undefined"==typeof e}function n(e){return r(e)===!1}function o(e){return"string"==typeof e}function i(e){return Array.prototype.slice.call(e)}function s(e,r,n){e.prototype=Object.create(r.prototype),t(n)&&u(e.prototype,n)}function u(e){e||(e={});var r,o,s,u,l,c,a,h=i(arguments).slice(1).filter(n),f=h.length;for(c=0;f>c;c++)if((r=h[c])&&t(r))for(s=Object.keys(r),l=s.length,a=0;l>a;a++)u=s[a],o=r[u],e[u]=o;return e}function t(e){return null!==e&&"object"==typeof e}function l(e){h.call(this),this.url_=null,this.global=e,0===this.global.location.hash.length&&this.url("/"),this.sync();var t=this;this.onHashChange_=function(){t.url()!==t.oldUrl&&(t.sync(),t.replace===t.url()?t.replace=null:(t.replace&&(t.replace=null),t.emit("urlChange",t.url(),t.oldUrl)))},e.addEventListener("hashchange",this.onHashChange_)}function c(e){h.call(this),this.url_=null,this.browser=e,this.sync();var t=this;this.onUrlChangeListener=function(e,r){t.sync(),t.emit("locationChangeStart",t.url(),t.oldUrl)?t.emit("locationChangeSuccess",t.url(),t.oldUrl):t.url(r,1)},this.browser.on("urlChange",this.onUrlChangeListener)}!function(e){function t(){this._events={}}function r(e){return"undefined"==typeof e}t.prototype={on:function(e,t){return this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t),this},off:function(e,t){var r,n=this._events[e];for(r=0;r<n.length;r++)n[r]==t&&n.splice(r,1);return this},emit:function(e){var t,o,i,s=n(arguments).slice(1);if(this._events.hasOwnProperty(e)){for(i=this._events[e],o=new Array(i.length),t=0;t<i.length;t++)o[t]=i[t].apply(this,s);return o.every(function(e){return r(e)?!0:e})}return!0},removeAllListeners:function(){var e,t,r=Object.keys(this._events),n=r.length;for(e=0;n>e;e++)t=r[e],this._events[t]=[]}};var n=function(e){return Array.prototype.slice.call(e)};Array.isArray,e.eventemitter={EventEmitter:t}}(e);var a=Array.isArray||function(e){return t(e)&&e instanceof Array==1},h=e.eventemitter.EventEmitter;s(l,h,{url:function(e,t){if(!e)return this.url_;var r=this.global;return t&&(this.replace=e),r.location.hash=e,this},sync:function(){var e=this.global.location.hash.substring(1);return e!==this.url_&&(this.oldUrl=this.url_,this.url_=e),this},destroy:function(){this.removeAllListeners(),this.global.removeEventListener("hashchange",this.onHashChange_)}}),s(c,h,{url:function(e,t){return e?(this.browser.url(e,t),this):this.url_},search:function(e){var r=this.url().split("?");return t(e)?(r[1]=v.stringify(e),this.url(r.join("?")),this):v.parse(r[1])},path:function(e,t){var r=this.url().split("?");return e?(r[0]=e,this.url(r.join("?"),t),this):r[0]},sync:function(){var e=this.browser.url();return e!==this.url_&&(this.oldUrl=this.url_,this.url_=e),this},destroy:function(){this.browser.off("urlChange",this.onUrlChangeListener)}});var f=function(e){return decodeURIComponent(e)},p=function(e){return encodeURIComponent(e)},v={stringify:function(e){var t,r,n,o=Object.keys(e),i=new Array(o.length);for(t=o.length-1;t>=0;t--)r=o[t],n=e[r],a(n)&&(n=n.join(",")),i[t]=p(r)+"="+p(n);return i.join("&")},parse:function(e){if(o(e)){var t,r,n,i={},s=e.split("&").filter(function(e){return e.length>0}).map(function(e){return e.split("=").filter(function(e){return e.length>0})});for(t=s.length-1;t>=0;t--)n=s[t],r=f(n[0]),i[r]=f(n[1]);return i}return{}}};e.$location={Location:c,Browser:l}}(),!function(e){function t(e,t,n){e.prototype=Object.create(t.prototype),r(n)&&s(e.prototype,n)}function r(e){return null!==e&&"object"==typeof e}function n(e){return Array.prototype.slice.apply(e)}function o(e){return i(e)===!1}function i(e){return"undefined"==typeof e}function s(e){e||(e={});var t,i,s,u,l,c,a,h=n(arguments).slice(1).filter(o),f=h.length;for(c=0;f>c;c++)if((t=h[c])&&r(t))for(s=Object.keys(t),l=s.length,a=0;l>a;a++)u=s[a],i=t[u],e[u]=i;return e}function r(e){return null!==e&&"object"==typeof e}function u(){this._events={}}function l(e){u.call(this),this.routes=e||{},this.current=null,this.preparedRoute=null}Array.isArray||function(e){return r(e)&&e instanceof Array==1},u.prototype={on:function(e,t){return this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t),this},off:function(e,t){var r,n=this._events[e];for(r=0;r<n.length;r++)n[r]==t&&n.splice(r,1);return this},emit:function(e){var t,r,i,s=n(arguments).slice(1);if(this._events.hasOwnProperty(e))for(i=this._events[e],r=new Array(i.length),t=0;t<i.length;t++)r[t]=i[t].apply(this,s);return r&&r.length>0?r.every(function(e){return o(e)?e:!0}):!0},removeAllListeners:function(){var e,t,r,n,o,i=Object.keys(this._events),s=i.length;for(e=0;s>e;e++)for(o=i[e],n=this._events[o],r=n.length,t=0;r>t;t++)n.splice(t,1)}},l.createPathRegExp=function(e,t){t=t||{};var r=t.caseInsensitiveMatch,n={originalPath:e,regexp:e},o=n.params=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?{(\w+)([\?\*])?}/g,function(e,t,r,n){var i="?"===n?n:null,s="*"===n?n:null;return o.push({name:r,optional:!!i}),t=t||"",""+(i?"":t)+"(?:"+(i?t:"")+(s&&"(.+?)"||"([^/]+)")+(i||"")+")"+(i||"")}).replace(/([\/$\*])/g,"\\$1"),n.regexp=new RegExp("^"+e+"$",r?"i":""),n},t(l,u,{constructor:l,when:function(e,t){var r=this.routes;if(this.routes.hasOwnProperty(t))throw new Error('Redefinition of route "'+e+'"');return r[e]=s(t,l.createPathRegExp(e)),this},prepare:function(e){var t=this.current;return this.preparedRoute=e,this.emit("routeChangeStart",e,t)?!0:!1},commit:function(){var e=this.preparedRoute;this.current=e},go:function(e){var t=this.parse(e);this.prepare(t)||this.emit("routeNotFound",e)},parse:function(e){for(var t,r,n=Object.keys(this.routes),o=this.routes,i=0;i<n.length;i++)if(t=o[n[i]],r=e.match(t.regexp))return t}});var c={};e.router={Router:l,routes:c,router:new l(c)}}(e),function(){function t(e,t,n){e.prototype=Object.create(t.prototype),r(n)&&u(e.prototype,n)}function r(e){return null!==e&&"object"==typeof e}function n(e){return Array.prototype.slice.apply(e)}function o(e){return i(e)===!1}function i(e){return"undefined"==typeof e}function s(e,t,n){var o;if(c(e))for(i=0,o=e.length;o>i;i++)t.call(n,e[i],i,e);else if(r(e)){var i,s,u,l=Object.keys(e),a=l.length;for(i=0;a>i;i++)s=l[i],u=e[s],t.call(n,u,s,e)}return e}function u(e){r(e)||(e={});var t,i,s,u,l,c,a,h=n(arguments).slice(1).filter(o),f=h.length;for(c=0;f>c;c++)if((t=h[c])&&r(t))for(s=Object.keys(t),l=s.length,a=0;l>a;a++)u=s[a],i=t[u],e[u]=i;return e}function r(e){return null!==e&&"object"==typeof e}function l(e,t){router.Router.call(this,t);var r,n=this;this.location=e,this.location.on("locationChangeStart",function(e){(r=n.parse(e))&&n.prepare(r)}).on("locationChangeSuccess",function(){n.commit()})}var c=Array.isArray||function(e){return r(e)&&e instanceof Array==1};e.eventemitter.EventEmitter,t(l,router.Router,{constructor:l,prepare:function(e,t){t=t||this.location.url();var r,n=(t.match(e.regexp)||[]).slice(1),o=this.current;return this.preparedRoute=e,e.params={},e.originalPath.replace(/{(\w+)}/g,function(t,o){(r=n.shift())&&(e.params[o]=r)}),this.emit("routeChangeStart",e,o)?!0:!1},commit:function(){this.current=this.preparedRoute,this.emit("routeChangeSuccess")}});var a=e.$location,h=new a.Browser(e),f=new a.Location(h);renderer.router=new l(f),renderer.controller=function(e,t){t=t||{};var r=[];return s(t,function(e){r.push(e)}),r.unshift(e),new(Function.prototype.bind.apply(e,r))},u(renderer.router,{browser:h,location:f,Router:l});var p=renderer.bootstrap;renderer.bootstrap=function(e){p(e);var t=renderer.router.location,r=renderer.router.parse(t.path());renderer.router.prepare(r),renderer.router.commit()},renderer.register("ndView",function(){return{restrict:"A",terminal:!0,priority:400,transclude:"element",compile:function(e){function t(e,t,r,n,o){function i(){var r=renderer.router.current;l&&((s=l.parentNode)&&s.removeChild(l),l=null),u&&u.destroy(),r&&(u=e.clone(),o(u,function(e){s=t.parentNode,r.hasOwnProperty("templateUrl")&&renderer.templateCache(r.templateUrl)&&(r.template=renderer.templateCache(r.templateUrl),delete r.templateUrl),s&&s[t.nextSibling?"insertBefore":"appendChild"](e,t.nextSibling),l=e}))}renderer.router.on("routeChangeSuccess",function(){e.apply(i)}),i();var s,u,l}return t}}}),renderer.register("ndView",function(){return{restrict:"A",priority:-400,link:function(e,t,r,n,o){var i=renderer.router.current;t.innerHTML=i.template;var s=renderer.compile(t.childNodes);if(i.locals||(i.locals={}),u(i.locals,{scope:e,attrs:r,element:t,transclude:o,routeParams:i.params}),i.controller){var l=renderer.controller(i.controller,i.locals);"string"==typeof i.controllerAs&&(e[i.controllerAs]=l)}s(e)}}})}(),renderer.module("nd.packages").service("$location",function(){return renderer.router.location}),renderer.module("nd.packages").service("$route",function(){return e.renderer.router})}(window,window)}();